# 关闭显示器！ 

我可真是受够了这群半夜踩键盘把电脑屏幕踩亮的臭猫咪了！

## 为什么要写这玩意
想必你也一定有过这样的烦恼，当你躺在床上社会性睡眠的时候，忽然猫咪跳到了桌子上，把熄屏的电脑屏幕踩亮

而你恰好：  
晚上睡觉没有关闭电脑的习惯  
上床之前没有手动关闭显示器电源的习惯  
显示器的自动休眠时间非常长  
浑身懒癌发作不愿意爬起来去关屏幕  
并且你养的懒猫也不愿意抬抬爪子帮你关一下显示器

……好吧，我相信大多数人应该不会有这样的烦恼，但是总之，在半夜被显示器最大亮度糊脸失眠几十次以后，我终于忍无可忍，写出了这么个小玩意。

## 这玩意能干什么
在本地30001端口开启HTTP监听，接到特定HTTP请求后发送消息关闭电脑的显示器。  
配合IOS的捷径功能，就可以实现对着手表或者手机 “Hi Siri，关闭显示器” 隔空语音关闭显示器的功能了

当然关闭显示器这个动作实际上只需要一条PostMessage指令就可以实现。这里完全可以自由扩展，根据指令的不同来执行不同的操作，只是我目前还完全没有想到其他需求，毕竟社畜除了睡觉以外，其他时间都是坐在电脑前的。

## 具体功能
软件没有主窗体，在运行后会在右下角托盘显示图标。右键点击可以选择退出。
<img width="400" src="https://raw.githubusercontent.com/Natsukage/Assets/main/ScreenOff/images/shortcut.png"/>  
在IOS的快捷指令中按照如图所示进行设置，通过HTTP请求将screen=off参数Post至PC的30001端口即可触发软件中写好的指令，通过发送消息关闭显示器。
这里增加了一条判断，即只有当当前wifi是自家wifi时候才会执行指令，实际是没必要的。而且如果这么判断了，后面还需要加一条判断，即如果设备是apple watch的话 那么就不考虑局域网问题执行快捷指令。因为手表在和手机连接时，自己是没有连接wifi的，所以获取wifi名称的这步判断也会直接判非。  
**实际真正重要的只有第四行的获取文本内容这条**，只要这一句指令就足以控制显示器关闭了。

其他认证啊、加密啊、自定义端口啊什么的功能自然都是没写的，一切突出一个够用就行。不过要加的话也不复杂。

## 重要提醒
这里的监听注册了`http://*:30001/`，而按照windows默认的安全规则，注册localhost以外的监听是需要管理员权限的。因此要么每次都使用管理员权限启动程序，要么用管理员权限打开CMD，输入`netsh http add urlacl url=http://*:30001/ user=Everyone`授权所有用户即可一劳永逸  
此外，如果测试时快捷指令卡住，记得关掉Windows防火墙试试。windows自带防火墙默认是会阻止这样的请求的，而且阻止时不会有提示。我也没有在程序里自动添加防火墙规则，你需要手动放行TCP 30001端口才可以。